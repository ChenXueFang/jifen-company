<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>最喜爱的教育文章TOP5</title>
    <link rel="stylesheet" href="../css/myStyle.css">
    <script src="../js/jquery-2.1.4.min.js"></script>
    <script src="../js/vue.min.js"></script>
    <script>
      window.history.forward(1); 
    </script>
</head>

<body>
    <div class="index">
        <img src="../images/bg0.png" class="bgImg">
        <!-- 中间内容居中盒子 -->
        <div class="container">
            <!-- 标题 -->
            <div class="titleBox">
                <h1 class="title">最喜爱的教育文章TOP5</h1>
                <img src="../images/titleBorder.png" class="titleBorder">
            </div>
            <!-- top5-->
            <div class="topImg">
                <img src="../images/top1.png">
                <img src="../images/top2.png">
                <img src="../images/top3.png">
                <img src="../images/top4.png">
                <img src="../images/top5.png">
            </div>
            <div class="topEssay">
                <div class="topEssayCon" v-for="item in top5List">
                    <img :src="item.ArticleImg" class="topEssayImg">
                    <div class="essayNum">
                        <span class="topNum">{{item.ArticleIndex}}</span>
                        <img src="../images/topBg.png" class="essayNumImg">
                    </div>
                    <div class="essayTitle">{{item.ArticleTitle}}</div>
                    <div class="tickets top5Tickts"><span class="ticketsNum top5ticketsNum">{{item.LikeCount}}</span> 票</div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var app = new Vue({
            el: ".index",
            data: {
                top5List: [],
                allArticleList: [],
                webConfig:[],
            },
            created: function () {
                let that = this;
                $.getJSON("../js/articleJson.json", function (data) {
                    that.allArticleList = data;
                });
                $.getJSON("../js/config.json", function (data) {
                    that.webConfig=data;
                    that.Instance();
                });
                
                
            },
            computed: {
            },
            methods: {
                Instance: function () {
                    let that = this;
                    $.ajax({
                        type: "get",
                        url: this.webConfig[0].webUrl+"api/Active/GetCountArticleLike",
                        data: { source: that.webConfig[0].source, countType: 'article' },
                        dataType: 'JSON',
                        success: function (res) {
                            if (res.state==1 && res.rows&&res.rows.length > 0) {
                                var resrowsList = JSON.parse(res.rows[0].CountResult).slice(0,5);
                                $.each(resrowsList, function (i, value) {
                                    var articleInfo = that.allArticleList.filter((a) => {
                                        return a.articleId == value.ArticleId;
                                    });
                                    if (articleInfo != null&&articleInfo.length>0) {
                                        var neeArtInfo = {"LikeCount": value.LikeCount, "ArticleImg": articleInfo[0].articleImg, "ArticleTitle": articleInfo[0].title, "ArticleIndex": articleInfo[0].articleIndex};
                                        that.top5List.push(neeArtInfo);
                                    }
                                })
                            }
                            console.log(that.top5List)
                        },
                        error: function (errors) {

                        }
                    });
                },
            }
        });
    </script>
</body>

</html>